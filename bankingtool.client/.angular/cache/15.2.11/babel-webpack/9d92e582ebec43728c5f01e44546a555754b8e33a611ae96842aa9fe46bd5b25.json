{"ast":null,"code":"import { ClaimKey } from '../../constant/constant';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../local-storage.service\";\nexport class IndexedDbServiceService {\n  constructor(localstorage) {\n    this.localstorage = localstorage;\n    let idb = this.localstorage.getItem(ClaimKey.idb);\n    if (idb) {\n      this.db = JSON.parse(idb);\n    }\n  }\n  initDb(dbName, dbVersion, primaryKey, tableName, columns) {\n    return new Promise((resolve, reject) => {\n      const request = indexedDB.open(dbName, dbVersion);\n      request.onerror = event => {\n        reject(`Createing ${dbName}: IndexedDB error: ${event}`);\n      };\n      request.onupgradeneeded = event => {\n        const db = event.target.result;\n        const objectStore = db.createObjectStore(tableName, {\n          keyPath: primaryKey,\n          autoIncrement: true\n        });\n        columns.forEach(({\n          columnName,\n          isUnique\n        }) => objectStore.createIndex(columnName, columnName, {\n          unique: isUnique\n        }));\n      };\n      request.onsuccess = event => {\n        this.db = event.target.result;\n        this.localstorage.setItem(ClaimKey.idb, JSON.stringify(this.db));\n        resolve();\n      };\n    });\n  }\n  getAllData(tableName) {\n    return new Promise((resolve, reject) => {\n      const transaction = this.db.transaction([tableName], 'readonly');\n      const objectStore = transaction.objectStore(tableName);\n      const request = objectStore.getAll();\n      request.onerror = event => {\n        reject(`Get ${tableName}: IndexedDB error: ${event}`);\n      };\n      request.onsuccess = event => {\n        resolve(request.result);\n      };\n    });\n  }\n  addData(tableName, data) {\n    return new Promise((resolve, reject) => {\n      const transaction = this.db.transaction([tableName], 'readwrite');\n      const objectStore = transaction.objectStore(tableName);\n      const request = objectStore.add(data);\n      request.onerror = event => {\n        reject(`Add ${tableName}: IndexedDB error: ${event}`);\n      };\n      request.onsuccess = event => {\n        resolve();\n      };\n    });\n  }\n  deleteData(tableName, id) {\n    return new Promise((resolve, reject) => {\n      const transaction = this.db.transaction([tableName], 'readwrite');\n      const objectStore = transaction.objectStore(tableName);\n      const request = objectStore.delete(id);\n      request.onerror = event => {\n        reject(`Delete ${tableName}: IndexedDB error: ${event}`);\n      };\n      request.onsuccess = event => {\n        resolve();\n      };\n    });\n  }\n  updateData(tableName, data) {\n    return new Promise((resolve, reject) => {\n      const transaction = this.db.transaction([tableName], 'readwrite');\n      const objectStore = transaction.objectStore(tableName);\n      const request = objectStore.put(data);\n      request.onerror = event => {\n        reject(`Update ${tableName}: IndexedDB error: ${event}`);\n      };\n      request.onsuccess = event => {\n        resolve();\n      };\n    });\n  }\n  clearData(tableName) {\n    return new Promise((resolve, reject) => {\n      const transaction = this.db.transaction([tableName], 'readwrite');\n      const objectStore = transaction.objectStore(tableName);\n      const request = objectStore.clear();\n      request.onerror = event => {\n        reject(`Clear ${tableName}: IndexedDB error: ${event}`);\n      };\n      request.onsuccess = event => {\n        resolve();\n      };\n    });\n  }\n  deleteDatabase(databaseName) {\n    return new Promise((resolve, reject) => {\n      const deleteRequest = indexedDB.deleteDatabase(databaseName);\n      deleteRequest.onsuccess = () => {\n        console.log('Database deleted successfully');\n        resolve();\n      };\n      deleteRequest.onerror = event => {\n        console.error('Error deleting database:');\n        reject(`Error deleting database: `);\n      };\n    });\n  }\n  static {\n    this.ɵfac = function IndexedDbServiceService_Factory(t) {\n      return new (t || IndexedDbServiceService)(i0.ɵɵinject(i1.LocalStorageService));\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: IndexedDbServiceService,\n      factory: IndexedDbServiceService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"mappings":"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","names":["ClaimKey","IndexedDbServiceService","constructor","localstorage","idb","getItem","db","JSON","parse","initDb","dbName","dbVersion","primaryKey","tableName","columns","Promise","resolve","reject","request","indexedDB","open","onerror","event","onupgradeneeded","target","result","objectStore","createObjectStore","keyPath","autoIncrement","forEach","columnName","isUnique","createIndex","unique","onsuccess","setItem","stringify","getAllData","transaction","getAll","addData","data","add","deleteData","id","delete","updateData","put","clearData","clear","deleteDatabase","databaseName","deleteRequest","console","log","error","factory","providedIn"],"sourceRoot":"","sources":["D:\\Nirmal Learning Projects\\BankingTool\\bankingtool.client\\src\\app\\core\\indexedDBService\\indexed-db-service.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { ClaimKey } from '../../constant/constant';\r\nimport { LocalStorageService } from '../local-storage.service';\r\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class IndexedDbServiceService {\n  constructor(private localstorage: LocalStorageService) {\n    let idb = this.localstorage.getItem(ClaimKey.idb);\n    if (idb) {\n      this.db = JSON.parse(idb);\r\n    }\n  }\n  private db: IDBDatabase | undefined;\n\n  public initDb(dbName: string, dbVersion: number, primaryKey: string, tableName: string, columns: CreateIndexedDb[]): Promise<void> {\n    return new Promise<void>((resolve, reject) => {\n      const request = indexedDB.open(dbName, dbVersion);\n\n      request.onerror = (event) => {\n        reject(`Createing ${dbName}: IndexedDB error: ${event}`);\n      };\n\n      request.onupgradeneeded = (event) => {\n        const db = (event.target as any).result;\n        const objectStore = db.createObjectStore(tableName, { keyPath: primaryKey, autoIncrement: true });\n        columns.forEach(({ columnName, isUnique }) => objectStore.createIndex(columnName, columnName, { unique: isUnique }));\n      };\n\n      request.onsuccess = (event) => {\n        this.db = (event.target as any).result;\n        this.localstorage.setItem(ClaimKey.idb, JSON.stringify(this.db))\n        resolve();\n      };\n    });\n  }\n\n  public getAllData(tableName: string): Promise<any[]> {\n    return new Promise<any[]>((resolve, reject) => {\n      const transaction = this.db!.transaction([tableName], 'readonly');\n      const objectStore = transaction.objectStore(tableName);\n      const request = objectStore.getAll();\n      request.onerror = (event) => {\n        reject(`Get ${tableName}: IndexedDB error: ${event}`);\n      };\n      request.onsuccess = (event) => {\n        resolve(request.result);\n      };\n    });\n  }\n\n  public addData(tableName: string, data: any): Promise<void> {\n    return new Promise<void>((resolve, reject) => {\n      const transaction = this.db!.transaction([tableName], 'readwrite');\n      const objectStore = transaction.objectStore(tableName);\n      const request = objectStore.add(data);\n      request.onerror = (event) => {\n        reject(`Add ${tableName}: IndexedDB error: ${event}`);\n      };\n      request.onsuccess = (event) => {\n        resolve();\n      };\n    });\n  }\n\n  public deleteData(tableName: string, id: number): Promise<void> {\n    return new Promise<void>((resolve, reject) => {\n      const transaction = this.db!.transaction([tableName], 'readwrite');\n      const objectStore = transaction.objectStore(tableName);\n      const request = objectStore.delete(id);\n      request.onerror = (event) => {\n        reject(`Delete ${tableName}: IndexedDB error: ${event}`);\n      };\n      request.onsuccess = (event) => {\n        resolve();\n      };\n    });\n  }\n\n  public updateData(tableName: string, data: any): Promise<void> {\n    return new Promise<void>((resolve, reject) => {\n      const transaction = this.db!.transaction([tableName], 'readwrite');\n      const objectStore = transaction.objectStore(tableName);\n      const request = objectStore.put(data);\n      request.onerror = (event) => {\n        reject(`Update ${tableName}: IndexedDB error: ${event}`);\n      };\n      request.onsuccess = (event) => {\n        resolve();\n      };\n    });\n  }\n\n  public clearData(tableName: string): Promise<void> {\n    return new Promise<void>((resolve, reject) => {\n      const transaction = this.db!.transaction([tableName], 'readwrite');\n      const objectStore = transaction.objectStore(tableName);\n      const request = objectStore.clear();\n      request.onerror = (event) => {\n        reject(`Clear ${tableName}: IndexedDB error: ${event}`);\n      };\n      request.onsuccess = (event) => {\n        resolve();\n      };\n    });\n  }\n  public deleteDatabase(databaseName: string): Promise<void> {\n    return new Promise<void>((resolve, reject) => {\n      const deleteRequest = indexedDB.deleteDatabase(databaseName);\n\n      deleteRequest.onsuccess = () => {\n        console.log('Database deleted successfully');\n        resolve();\n      };\n\n      deleteRequest.onerror = (event) => {\n        console.error('Error deleting database:');\n        reject(`Error deleting database: `);\n      };\n    });\n  }\n}\nexport interface CreateIndexedDb {\n  columnName: string;\n  isUnique: boolean;\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}